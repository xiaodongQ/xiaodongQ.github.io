---
layout: post
title: 《TCP/IP详解 卷一:协议》学习笔记
categories: [学习笔记]
tags: [TCP/IP, 协议]
---

#content
{:toc}


# 《TCP/IP详解 卷一:协议》

## 第一章 概述

1. TCP/IP协议族：四层协议系统

	* 链路层（数据链路层、网络接口层）
	设备驱动程序和网络接口卡。

	* 网络层（互联网层）
	处理分组在网络中的活动，点对点服务。IP、ICMP、IGMP

	* 运输层
	提供端对端通信。TCP、UDP

	* 应用层
	处理应用程序细节。Telnet、FTP、SMTP、SNMP

2. 部分概念

	* 构造互联网最简单的方法是把两个或多个网络通过路由器（Router）进行连接。

		路由器的好处是为不同类型的物理网络提供连接：以太网、令牌环网、点对点的链接等等。

	* 网络层IP协议提供的是一种不可靠的服务。

		只是尽可能快地把分组从源地址到目标地址

	* 互联网地址：类别+网络号+主机号

		IP地址长32bit（4字节）ABCDE类 0一字节 10两字节 110三字节 1110 11110

	* 域名系统（DNS）提供IP地址和主机名之间的映射

	* 封装。

		每层对收到的数据添加一些首部信息（有些还有尾部信息），传给下一层

		TCP传给IP的数据单元称TCP报文段或TCP段（TCP segment）；

		IP传给接口层的数据单元称作IP数据报（IP datagram），

		更准确地说，IP和网络接口层之间传送单元应该是分组（packet），可以是IP数据报，也可以是IP数据报的一个片（fragment）；

		通过以太网传输的比特流称作帧（Frame）

	* 目的主机收到一个以太网数据帧时，从协议栈由底向上，去掉各层协议加上的报文首部，以确定接收数据的上层协议。这个过程称作分用（Demultiplexing）；

	* 服务器上的应用程序一般通过端口号来识别。

		知名端口号1~1023（保留端口号）

		客户端通常不关心端口号，保证唯一就行了，因此客户端口号又称临时端口号，大多分配1024~5000。（由于客户端不是长期启动运行，程序关闭后端口就释放了）
		FTP 21，TCP 23

	* 所有关于Internet的正式标准都以RFC（Request for Comment）文档出版。用数字标识，数字越大说明内容越新。

	* 当使用TCP和UDP提供相同的服务时，一般选择相同端口号。

		很多端口号都是奇数：历史原因，这些端口派生于ARPANET的运输层协议NCP（网络控制协议），而NCP是单工的，不是全双工的，因此每个应用程序都需两个连接，需预留一对奇数和偶数端口号。

		TCP和UDP称为标准的运输层协议时，每个应用程序只需要一个端口号。

	* internet和Internet含义不同

		internet 指用一个共同协议族把多个网络连接在一起；

		Internet 指全世界范围通过TCP/IP互相通信的主机集合（超过100万台）。Internet是一个internet，但internet不等于Internet。
		构造互联网的共同基石是路由器。

## 第二章 链路层

1. 链路层主要有三个目的

	* 为IP模块发送和接收IP数据报；

	* 为ARP模块发送ARP请求和接收ARP应答；（ARP   地址解析协议）

	* 为RARP发送RARP请求和接受RARP应答。（RARP 逆地址解析协议）

2. 以太网这个术语一般指 数字设备公司DEC、因特尔公司Intel、Xerox公司于1982年联合公布的一个标准。

	它是当今TCP/IP采用的主要局域网技术。

	IEEE802委员会公布了一个标准集。 802.3针对整个CSMA/CD网络、802.4针对令牌总线网络、802.5针对令牌环网络，这三者的共同特性由802.2标准来定义。

3. 串行线路IP（SLIP：Serial Line IP）和 压缩的SLIP（称作CSLIP）

	一种在串行线路上对IP数据报进行封装的简单形式。在数据报的开头和结尾都加一个特殊字符（END字符 0xc0）

4. 点对点协议PPP
	修改了SLIP的缺陷。

5. 环回接口（Loopback Interface）

	允许运行在同一台主机上的客户程序和服务程序通过TCP进行通信。

	大多数系统将 127.0.0.1 分配给这个接口，并命名为localhost。一个传给环回接口的IP数据报不能在任何网络上出现。

6. 最大传输单元 MTU

	以太网和802.3对数据帧的长度都有一个限制，链路层的这个特性称作MTU，最大传输单元。
	若需传输的数据报比MTU还大，IP层就需要进行分片（fragmentation）

7. 同一个网络上的两台主机通信，重要的是两台主机路径中的最小MTU，称作路径MTU。

8. 串行线路吞吐量计算

	e.g.
	线路速率 9600 b/s，一个字节8 bit，一个起始比特、一个停止比特，则速率就是 9600/(8+2) = 960 B/s （字节/秒）

	传输一个1024字节的分组需要 1024/960 = 1066 ms，两个应用程序交互则须等待一般时间 533ms（参考两者相向而行）。（研究称交互响应超过100~200ms被认为是不好的）

## 第三章 IP：网际协议

1. IP是TCP/IP协议族中最为核心的协议。

	所有的TCP、UDP、ICMP及IGMP数据都以IP数据报格式传输。

	不可靠(unreliable)：它不能保证IP数据报数据能成功地到达目的地；

	无连接(connectionless)：IP并不维护任何关于后续数据报的状态信息，每个数据报的处理是相互独立的。

	> 说明IP数据报可以不按发送顺序接收。

2. IP首部

| 4位版本 | 4位首部 | 16位总长度 |
|------|-------:|-------|
